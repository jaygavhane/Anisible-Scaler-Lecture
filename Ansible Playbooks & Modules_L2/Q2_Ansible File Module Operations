Description
In this lab, you will learn how to use the Ansible file module to manage files and directories on a remote server in a safe, idempotent, and declarative way.

You are provided with an Ansible control node and a managed node (server1). Your task is to write and execute an Ansible playbook that creates a structured application directory hierarchy under /opt, sets correct ownership and permissions, creates a configuration file, and removes an unwanted temporary file.

This lab focuses on state-based configuration management, meaning your solution is evaluated based on the final system state, not the specific commands you type.

Required Credentials for the Lab:

SSH Credentials: (for remote connection to server1)
SSH Username: server1_admin
SSH Password: server1_admin@123!
Sudo Credentials (for privilege escalation)
Sudo Password: server1_admin@123!
Tasks
1. Create a working directory named workspace under /home/user on the Ansible control node

2. Inside the workspace directory, create an inventory.ini file that:

Defines a host group named web

Includes server1 with correct SSH and sudo credentials

Allows Ansible to connect and perform privileged operations

3. Create an Ansible playbook named "file-operations.yml" inside the "workspace" directory.

4. In the playbook:

Target the web host group

Enable privilege escalation using become

Disable fact gathering

Use the file module to:

Create /opt/app with mode 0755

Create /opt/app/logs with mode 0755

Create /opt/app/config with mode 0750

Create an empty file /opt/app/config/app.conf with mode 0644

Remove /tmp/old_file.txt if it exists

5. Before running the playbook, manually create "/tmp/old_file.txt" on "server1" to validate file removal

6. Execute the playbook and verify:

All directories are created
Permissions are correctly applied
Configuration file exists
Temporary file is removed
Outcomes
After completing this lab, you will be able to:
Use the Ansible file module for directory and file management
Apply permissions using the mode parameter
Manage ownership with owner and group
Create empty configuration files declaratively
Remove files using state: absent
Understand idempotent file system automation with Ansible


-------------------------------------------------------------------------------


# Create inventory.ini file

file-operations.yaml  inventory.ini
user@8143b7821c93:~/workplace$ cat inventory.ini        
[web]
server1 ansible_host=server1 ansible_user=server1_admin ansible_ssh_pass=server1_admin@123! ansible_become_pass=server1_admin@123!
user@8143b7821c93:~/workplace$ 

# Need to under stand the requerements 

Target the web host group

Enable privilege escalation using become

Disable fact gathering

Use the file module to:

Create /opt/app with mode 0755

Create /opt/app/logs with mode 0755

Create /opt/app/config with mode 0750

Create an empty file /opt/app/config/app.conf with mode 0644

Remove /tmp/old_file.txt if it exists

# to remove /tmp/old_file.txt first we need to create file them we can delete

Command to create file in hosts

ansible web -i inventory.ini -m shell -a "mkdir -p /tmp/old_file.txt"

# No the last part creating the yaml file (playbook) as per requrements

user@8143b7821c93:~/workplace$ cat file-operations.yaml 
---
- name: Operation 
  hosts: web
  become: yes
  gather_facts: false

  tasks:
    - name: file create /opt/app
      file:
        path: /opt/app
        state: directory
        mode: 0755

    - name: file create /opt/app/logs
      file:
        path: /opt/app/logs
        state: directory
        mode: 0755

    - name: file create /opt/app/config
      file:
        path: /opt/app/config
        state: directory
        mode: 0750

    - name: creating an empty file
      file:
        path: /opt/app/config/app.conf
        state: touch
        mode: 0644
        owner: root
        group: root

    - name: removing file /tmp/old_file.txt
      file:
        path: /tmp/old_file.txt
        state: absent
user@8143b7821c93:~/workplace$ 


# Need to check syntax

First we will check the spacing by 

user@8143b7821c93:~/workplace$ cat -A file-operations.yaml 
---$
- name: Operation $
  hosts: web$
  become: yes$
  gather_facts: false$
$
  tasks:$
    - name: file create /opt/app$
      file:$
        path: /opt/app$
        state: directory$
        mode: 0755$
$
    - name: file create /opt/app/logs$
      file:$
        path: /opt/app/logs$
        state: directory$
        mode: 0755$
$
    - name: file create /opt/app/config$
      file:$
        path: /opt/app/config$
        state: directory$
        mode: 0750$
$
    - name: creating an empty file$
      file:$
        path: /opt/app/config/app.conf$
        state: touch$
        mode: 0644$
        owner: root$
        group: root$
$
    - name: removing file /tmp/old_file.txt$
      file:$
        path: /tmp/old_file.txt$
        state: absent$
user@8143b7821c93:~/workplace$ 

Then we will check the syntax

user@8143b7821c93:~/workplace$ ansible-playbook --syntax-check -i inventory.ini file-operations.yaml

playbook: file-operations.yaml
user@8143b7821c93:~/workplace$ 

# then will run the playbook 

user@8143b7821c93:~/workplace$ ansible-playbook -i inventory.ini file-operations.yaml

PLAY [Operation] *************************************************************************

TASK [file create /opt/app] **************************************************************
ok: [server1]

TASK [file create /opt/app/logs] *********************************************************
ok: [server1]

TASK [file create /opt/app/config] *******************************************************
ok: [server1]

TASK [creating an empty file] ************************************************************
changed: [server1]

TASK [removing file /tmp/old_file.txt] ***************************************************
ok: [server1]

PLAY RECAP *******************************************************************************
server1                    : ok=5    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

user@8143b7821c93:~/workplace$ 

Done..

# lets cross check file is created or not

user@8143b7821c93:~/workplace$ ansible web -i inventory.ini -m shell -a "ls -l /opt/app" 
server1 | CHANGED | rc=0 >>
total 8
drwxr-x--- 2 root root 4096 Jan 24 19:31 config
drwxr-xr-x 2 root root 4096 Jan 24 19:31 logs
user@8143b7821c93:~/workplace$ 


Done .....
